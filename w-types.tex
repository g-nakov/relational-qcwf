\documentclass[12pt,a4paper]{article}
\input{preamble.tex}

\autodefs{\bR}
\title{\vspace{-5em}Outline}
\date{\vspace{-3em}}

\begin{document}
\maketitle

Given a resource semiring $\bR$ with elements $s , t , u , \dots \in R$, define the following equivalence relation on the set $R^T \define \{0_\bR\} \cup \mu X. (R\setminus\{0_\bR\})  + X \times X$:
\begin{gather*}
  \tau \sim \rho \iff 
  \begin{cases}
     \tau = s,\ \rho = t \text{ and } s =_R t \\
     \tau = s,\ \rho = (\rho, \rho'') \text{ and } \tau \sim \rho' \text{ and } \tau \sim \rho''\\
     \tau = (\tau', \tau''),\ \rho = t \text{ and } \tau' \sim \rho \text { and } \tau'' \sim \rho \\
     \tau = (\tau', \tau''),\ \rho = (\rho', \rho'') \text{ and } \tau' \sim \rho' \text { and } \tau'' \sim \rho''      
  \end{cases}
\end{gather*}
\begin{claim}
  $R^T/\sim$ can be endowed with usage semiring structure.
\end{claim}
Adjust the $R-LCA$ to account for the tree structure by augmenting the operation $!_\tau : \algA \to \algA$ and the elements $W_{\pi\rho}$, $F_\rho$, $\delta_{\pi\rho}$:
\begin{gather*}
  !^T_\tau x \define 
  \begin{cases}
   [\ulcorner true \urcorner, !_s x]  &\text{ if } s = contract(\tau) \\
   [\ulcorner false \urcorner , E(!^T_{\tau'} x , !^T_{\tau''} x)],  &\text{ if } \langle\tau', \tau''\rangle = contract(\tau)\label{1}
  \end{cases}
\end{gather*}
The outermost pairing with Bool allows us to inspect/ the shape of the resource annotation internally within the BCI algebra.

Futhermore, it is also possible to define $W_{\pi\rho}$, $F_\rho$, $\delta_{\pi\rho}$, but that involves quite a few subtleties.\\

As an example usage of tree resource annotation, let's define the semantics of $\oplus$-types and check the rules are sound wrt. to it.\\
$\llbracket (A \oplus B)(\gamma)\rrbracket \define (|A(y)| \sqcup |B(y)|, \vDash_{A\oplus B(\gamma)} )$ , where \\

$ a \vDash_{A \oplus B(\gamma)} (i , x)$ iff 
$\begin{aligned}
  &(\exists\, a_x \in \algA. a = [\ulcorner true \urcorner, a_x] \land a_x \vDash_{A(\gamma)} x \land \ulcorner true \urcorner \vDash_{Bool(\gamma)} i)\ \lor \\
  & (\exists\, b_x \in \algA. a = [\ulcorner false \urcorner, b_x] \land b_x \vDash_{B(\gamma)} x \land \ulcorner false \urcorner \vDash_{Bool(\gamma)} i) 
\end{aligned}$

\begin{figure}[h]
\begin{align*}
  \infer[\oplus\text{-type}]{0\Gamma \vdash A \oplus B}{
    0\Gamma \vdash A &
    0\Gamma \vdash B} & & 
  \infer[\text{inl}]{\Gamma \vdash \mathbf{inl}\, M \of \sigma A \oplus B}{
      \Gamma \vdash M \of{\sigma} A} & &
    \infer[\text{inr}]{\Gamma \vdash \mathbf{inr}\, N \of \sigma A \oplus B}{
      \Gamma \vdash N \of{\sigma} B
    }
  \end{align*}
  \begin{gather*}
  0\Gamma, x \of{0} A \oplus B \vdash C \\
  \infer[\oplus \text{-elim}]{\Gamma' + \langle\rho, \pi\rangle\Gamma \vdash \mathbf{case}(M, T_a, T_b) \of{\sigma} C[M / x]}{
    \Gamma \vdash M \of \sigma A \oplus B &&
    \Gamma', a \of {\rho} A \vdash T_a \of{\sigma} C[\mathbf{inl}\,a/x] && 
    \Gamma', b \of{\pi} B \vdash T_b \of{\sigma} C[\mathbf{inr}\, b/x] &&
    0\Gamma = 0\Gamma'
  }
  \end{gather*}
\caption{Rules for $\oplus$-types}
\end{figure}
WLOG, let's verify the soundness of $\mathbf{inl}$ and $\mathbf{case}$.\\
Given a realiser $a_M$ for $\forall \gamma \in |\Gamma|. M(\gamma)$, let $a_{\mathbf{inl}} \define \lambda^* a_\gamma. [\ulcorner true \urcorner, a_M \cdot a_\gamma]$
\newpage
Given realisers $a_M$, $a_T$ and $b_T$, s.t:\\
$\forall \gamma \in |\Gamma|, a_\gamma \in \algA. a_\gamma \vDash_{\Gamma} y \implies a_M \cdot a_y \vDash_{A \oplus B (\gamma)} M(\gamma)$,\\
$\forall \gamma' \in |\Gamma'|, s \in |A(\gamma')|,  a'_\gamma \in \algA, a_s \in \algA. a'_\gamma \vDash_{\Gamma} \gamma' \land a_s \vDash_{A(\gamma)} s \implies a_T \cdot [a'_\gamma , !_\rho a_s] \vDash_{C(\gamma' , inl(s))} T_a(\gamma', s)$,\\
$\forall \gamma' \in |\Gamma'|, t \in |B(\gamma')|,  a'_\gamma \in \algA, a_t \in \algA. a'_\gamma \vDash_{\Gamma} \gamma' \land a_t \vDash_{B(\gamma)} t \implies b_T \cdot [a'_\gamma , !_\pi a_t] \vDash_{C(\gamma' , inr(t))} T_b(\gamma', t)$,\\
let $a_{case} \define
%\begin{aligned}
% W_{1 \langle\rho , \pi \rangle} \cdot (\lambda^* & a'_{!\gamma}\ a_{!\gamma}.  &&\comment{-- unwrap $(1  + \langle \rho , \pi \rangle) \Gamma$}\\
% &\text{let }[inj, a_m] = a_M \text{ in } &&\comment{-- pattern match on $M$}\\
% &\text{let }[collapsed, a_r] = a_{!\gamma} \text{ in } &&\comment{-- check if $\langle \pi , \rho \rangle$ collapsed}\\
% &\text{let }[c_T, inj'] = E([a_T , \ulcorner true \urcorner], [b_T , \ulcorner false \urcorner]) \cdot inj \text{ in } &&\comment{--}\\
% &\comment{-- check the right realiser and rewrap a boolean value}&&\\
% &\comment{-- so the linearity of inj is not violated }&&\\
% & c_T \cdot [D\cdot a'_{!\gamma} ,  &&\\
% & \quad\quad E(\lambda^*r\, m. , \lambda^*r . , ) \cdot collapsed \cdot a_r \cdot a_m]
%\end{aligned}$
\begin{aligned}
  W_{1 \langle\rho , \pi \rangle} \cdot (\lambda^* & a'_{!\gamma}\ a_{!\gamma}.  &&\comment{-- unwrap $(1  + \langle \rho , \pi \rangle) \Gamma$}\\
  & \dots F_{\langle \pi , \rho \rangle} \cdot !_{\langle \pi , \rho \rangle}(\lambda^* r. a_M \cdot r ) . a_{!\gamma} \dots &&
\end{aligned}$\\
Problem : We end up with something of the shape $!_{\langle \pi , \rho \rangle}([\ulcorner boolean \urcorner,  x ])$ and want to select the projection depending on the inner boolean value.
\end{document}